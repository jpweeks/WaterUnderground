if(!window.requestAnimationFrame)window.requestAnimationFrame=function(){return window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1E3/60)}}();(function(a){a.SphereGeometry=function(b,f,c,n,k,h,j){a.Geometry.call(this);this.radius=b=b||50;this.widthSegments=f=Math.max(3,Math.floor(f)||8);this.heightSegments=c=Math.max(2,Math.floor(c)||6);this.phiStart=n=void 0!==n?n:0;this.phiLength=k=void 0!==k?k:2*Math.PI;this.thetaStart=h=void 0!==h?h:0;this.thetaLength=j=void 0!==j?j:Math.PI;var e,g,u=[],i=[];for(g=0;g<=c;g++){var d=[],o=[];for(e=0;e<=f;e++){var r=e/f,l=g/c,q=new a.Vector3;q.x=-b*Math.cos(n+r*k)*Math.sin(h+l*j);q.y=b*Math.cos(h+l*j);
q.z=b*Math.sin(n+r*k)*Math.sin(h+l*j);this.vertices.push(q);d.push(this.vertices.length-1);o.push(new a.Vector2(r,1-l))}u.push(d);i.push(o)}for(g=0;g<this.heightSegments;g++)for(e=0;e<this.widthSegments;e++){var f=u[g][e+1],c=u[g][e],n=u[g+1][e],k=u[g+1][e+1],h=this.vertices[f].clone().normalize(),j=this.vertices[c].clone().normalize(),d=this.vertices[n].clone().normalize(),o=this.vertices[k].clone().normalize(),r=i[g][e+1].clone(),l=i[g][e].clone(),q=i[g+1][e].clone(),m=i[g+1][e+1].clone();Math.abs(this.vertices[f].y)===
this.radius?(r.x=(r.x+l.x)/2,this.faces.push(new a.Face3(f,n,k,[h,d,o])),this.faceVertexUvs[0].push([r,q,m])):Math.abs(this.vertices[n].y)===this.radius?(q.x=(q.x+m.x)/2,this.faces.push(new a.Face3(f,c,n,[h,j,d])),this.faceVertexUvs[0].push([r,l,q])):(this.faces.push(new a.Face3(f,c,k,[h,j,o])),this.faceVertexUvs[0].push([r,l,m]),this.faces.push(new a.Face3(c,n,k,[j.clone(),d,o.clone()])),this.faceVertexUvs[0].push([l.clone(),q,m.clone()]))}this.computeCentroids();this.computeFaceNormals();this.boundingSphere=
new a.Sphere(new a.Vector3,b)};a.SphereGeometry.prototype=Object.create(a.Geometry.prototype);a.Vector3.prototype.sphereCoord=function(b){function a(b){return b*(180/Math.PI)}var c,b=-a(Math.acos(this.y/b))+90;c=a(Math.atan(this.x/this.z))-90+(0<this.z?180:0);b=Math.round(2*b)/2;c=Math.round(2*c)/2;return[b,c]};a.Object3D.prototype.lookAt=function(b){this.matrix.lookAt(this.position,b,this.up);this.rotationAutoUpdate&&this.rotation.setRotationFromMatrix(this.matrix)}})(THREE);var WUG=function(a,b){var f={};(function(){var a=new b.Geometry;atts={displacement:{type:"f",value:[]},opacity:{type:"f",value:[]}};var e=new b.ShaderMaterial({attributes:atts,uniforms:{amount:{type:"f",value:0}},vertexShader:document.getElementById("vs-geo").textContent,fragmentShader:document.getElementById("fs-geo").textContent,transparent:!0,depthTest:!1});e.linewidth=2;var g,c,i,d,o=atts.displacement.value,h=atts.opacity.value,l=Math.PI;for(g=180;0<g;g--){i=g*(l/180);for(c=360;0<c;c--)d=c*(l/
180),d=new b.Vector3(480*Math.cos(d)*Math.sin(i),480*Math.cos(i),480*Math.sin(d)*Math.sin(i)),a.vertices.push(d),o.push(-192),h.push(0)}f.globe=new b.Line(a,e);f.globe.dynamic=!0;f.globe.radius=480})();(function(){var a=new b.Geometry,e=new b.ShaderMaterial({uniforms:{amount:{type:"f",value:0}},vertexShader:document.getElementById("vs-pin").textContent,fragmentShader:document.getElementById("fs-pin").textContent,depthTest:!1});e.linewidth=2;a.vertices=[new b.Vector3,new b.Vector3];f.hitLine=new b.Line(a,
e)})();(function(){var a=new b.Geometry,e=new b.ShaderMaterial({uniforms:{amount:{type:"f",value:0}},vertexShader:document.getElementById("vs-pin").textContent,fragmentShader:document.getElementById("fs-pin").textContent,depthTest:!1});e.linewidth=4;for(var g,c,i,d=2*Math.PI/10,o=0;10>=o;o++)g=10*Math.cos(d*o),c=10*Math.sin(d*o),g=10>o?new b.Vector3(g,c,0):i,0===o&&(i=g),a.vertices.push(g);f.hitPent=new b.Line(a,e);f.hitPent.scale.set(0,0,0)})();(function(){var a=new b.SphereGeometry(480,14,14),a=
new b.Mesh(a,new b.MeshBasicMaterial);a.visible=!1;f.hitTarget=a})();var c=new b.PerspectiveCamera(30,window.innerWidth/window.innerHeight,100,1E4),n=new b.AmbientLight(6316128),k=new b.Scene;k.add(c);k.add(n);k.add(f.globe);for(var h in f);a.view={scene:k,camera:c,objects:f};return a}(WUG||{},THREE,TWEEN);WUG=function(a,b){function f(a,b,f){var i,d=new XMLHttpRequest;d.open("GET",a,!0);d.onreadystatechange=function(){if(4===d.readyState&&200===d.status){h++;i=JSON.parse(d.responseText);for(var a=i.data,e=[],l=0,j=a.length;l<j;l++)e.push(""===a[l]?0:1);c[b]=a;n[b]=e;f&&f(b,h,k)}};d.setRequestHeader("Content-Encoding","gzip");d.setRequestHeader("Content-Type","application/json");d.send(null)}var c={current:a.view.objects.globe.material.attributes.displacement.value},n={current:a.view.objects.globe.material.attributes.opacity.value},
k=0,h=0,j=[{year:2002,month:4},{year:2011,month:5}];a.model={data:c,peaks:{},range:j,loadData:function(a,b,c){for(var i,d,h=[],n=j[0].year,l=j[0].month,q=j[1].year,m=j[1].month,s=12;0<s;s--)if(!(a==q&&s>m)){if(a==n&&s<l)break;i=2>s.toString().length?"0"+s:s;d=a+"-"+i;i="data/GRACE."+a+"."+i+".json";h.push(d);k++;f(i,d,c)}b(h)},tweenTo:function(a,g,h){for(var i=c[a],d=n[a],a=c[g],g=n[g],f=[],j=[],l={d:0},k=a.length,m=0;m<k;m++)f[m]=a[m]-i[m],j[m]=g[m]-d[m];b.removeAll();(new b.Tween(l)).to({d:1},300).easing(b.Easing.Cubic.EaseOut).onUpdate(function(){var a=
l.d,b=[],c=[];for(m=0;m<k;m++)b.push(i[m]+f[m]*a),c.push(d[m]+j[m]*a);h(b,c)}).onComplete(function(){}).start()}};return a}(WUG||{},TWEEN);WUG=function(a,b,f){var c,n,k,h,j,e,g,u,i,d,o,r,l,q,m,s,C;function D(a,b){return a.className.match(RegExp("(\\s|^)"+b+"(\\s|$)"))}function E(x){function b(){clearTimeout(f);g()}function c(){var x=i.split("-"),b=h;if(D(b,"active"))b.className=b.className.replace(/(\s|^)active(\s|$)/," ").replace(/^[ ]+|[ ]+$/,"");b=d;D(b,"active")||(b.className+=" active");g();S.textContent=T[x[1]]+" "+x[0];a.model.tweenTo(j,i,e);r=d;l=i}function e(a,x){k.displacement.value=a;k.opacity.value=x;k.displacement.needsUpdate=
!0;k.opacity.needsUpdate=!0}function g(){d.removeEventListener("mouseout",b,!1)}var d=this,h=r||d,f,i=d.getAttribute("data-date"),j=l;if(!i)return!1;j||(j="current");x&&"mouseover"==x.type?(d.addEventListener("mouseout",b,!1),f=setTimeout(c,200)):c();var k=a.view.objects.globe.material.attributes}function L(){for(var a=A.length,b=Math.floor(window.innerWidth/a),c=0;c<a;c++)A[c].style.width=b+"px"}function U(a){for(var b,c=0,d=a.length;c<d;c++)b=document.createElement("div"),b.setAttribute("id","month-"+
a[c]),b.setAttribute("data-date",a[c]),b.setAttribute("class","loading"),V.appendChild(b),A.push(b);L()}function W(a,b,c){if(a=document.getElementById("month-"+a))a.setAttribute("class","loaded"),a.addEventListener("mouseover",E);1==b&&(M(),E.call(a));if(b==c)document.body.className="loaded"}function N(){var b=l,b=!b?a.model.range[1].year:b.split("-")[0]-1;if(b<a.model.range[0].year)return q=!0,!1;document.body.className="loading";a.model.loadData(b,U,W)}function F(a){i=-a.clientX;d=a.clientY;a=w/
1E3;k=c+0.0050*(i-g)*a;h=n+0.0050*(d-u)*a;h=h>B?B:h;h=h<-B?-B:h}function G(){p.removeEventListener("mousemove",F,!1);p.removeEventListener("mouseup",G,!1);p.removeEventListener("mouseout",H,!1);p.style.cursor="auto"}function H(){p.removeEventListener("mousemove",F,!1);p.removeEventListener("mouseup",G,!1);p.removeEventListener("mouseout",H,!1)}function M(){requestAnimationFrame(M);var a;a=s||0;s=a=a<z?a+z/128:0;m&&(a=Math.sin(s),X.scale.set(a,a,1));O(Y);j+=0.1*(k-j);e+=0.1*(h-e);w+=v-w;t.position.x=
w*Math.sin(j)*Math.cos(e);t.position.y=w*Math.sin(e);t.position.z=w*Math.cos(j)*Math.cos(e);P.y=-t.position.y/10;t.lookAt(P);y.clear();y.render(Q,t);f.update()}function O(a){v-=a;v=2200<v?2200:v;v=1200>v?1200:v}function I(){var a=C||!1;if(a)R.className="";else{var b=R;D(b,"show")||(b.className+=" show")}C=!a;a?p.removeEventListener("mousedown",I,!1):p.addEventListener("mousedown",I,!1)}q=!1;r=void 0;l=void 0;m=void 0;s=void 0;C=void 0;var p=document.createElement("div");document.body.appendChild(p);
var V=document.getElementById("gui-container"),S=document.getElementById("date-display"),R=document.getElementById("about");document.getElementById("about-toggle").addEventListener("click",I,!1);document.addEventListener("keydown",function(a){var b,c,d=r||A[0];switch(a.keyCode){case 16:o=!0;break;case 39:b=d.previousSibling;c="next";break;case 37:b=d.nextSibling,c="prev"}b?E.call(b,a):"prev"==c&&!q&&N()},!1);document.addEventListener("keyup",function(a){switch(a.keyCode){case 16:o=!1}},!1);p.addEventListener("mousedown",
function(a){a.preventDefault();p.addEventListener("mousemove",F,!1);p.addEventListener("mouseup",G,!1);p.addEventListener("mouseout",H,!1);g=-a.clientX;u=a.clientY;c=k;n=h;if(o){var d,e,f;f=J.hitPent;e=J.hitLine;a=new THREE.Vector3(2*(a.clientX/window.innerWidth)-1,2*-(a.clientY/window.innerHeight)+1,0.5);Z.unprojectVector(a,t);a=(new b.Ray(t.position,a.subSelf(t.position).normalize())).intersectScene(Q);if(0<a.length)a=a[0].point,m=d=a.sphereCoord($),console.log(d),f.position.copy(a),f.lookAt(new b.Vector3(0,
0,0)),a=a.clone().normalize(),f=a.clone().multiplyScalar(1E4),a=a.clone().multiplyScalar(350),e=e.geometry.vertices,e[0].copy(f),e[1].copy(a)}p.style.cursor="move"},!1);p.addEventListener("mousewheel",function(a){a.preventDefault();K&&O(0.3*a.wheelDeltaY);return!1},!1);var K=!1;p.addEventListener("mouseover",function(){K=!0},!1);p.addEventListener("mouseout",function(){K=!1},!1);window.addEventListener("resize",function(){console.log("resize");t.aspect=window.innerWidth/window.innerHeight;t.updateProjectionMatrix();
y.setSize(window.innerWidth,window.innerHeight);L()},!1);var A=[],T={"01":"January","02":"February","03":"March","04":"April","05":"May","06":"June","07":"July","08":"August","09":"September",10:"October",11:"November",12:"December"},Z=new b.Projector,J=a.view.objects,$=J.globe.radius,z=Math.PI,B=z/2;o=!1;i=0;d=0;g=0;u=0;j=3*z/2;e=z/6;k=0;h=0;c=0;n=0;var Y=0,Q=a.view.scene,w=1E4,v=1900,t=a.view.camera,P=new b.Vector3(0,0,0);t.position.z=w;var y=new b.WebGLRenderer;y.autoClear=!1;y.setClearColorHex(0,
0);y.setSize(window.innerWidth,window.innerHeight);p.appendChild(y.domElement);var X=a.view.objects.hitPent;N();return a}(WUG||{},THREE,TWEEN);
